# 파일 업로드 & 삭제

​                     

### 0. 구현

* Basic 버튼을 클릭하면 사이트에서 제공하는 기본 이미지 목록을 불러올 수 있다.
* MyCapture 버튼을 누르면 내가 저장한 이미지 목록들을 볼 수 있다.(최대 10개 제한)
  * MyCapture 버튼을 누르면 편집 버튼이 활성화 된다.

​                     

#### - ERD를 통한 DB 구조 변경

<img src="파일업로드.assets/image-20220620145018342.png" alt="image-20220620145018342" style="zoom:33%;" />

* 파일 목록을 관리하기 위한 테이블을 생성한다(=snapshot).

  * `filename`: 파일의 이름
  * `path`: 파일 저장 경로
  * `host`: 주체, `admin` 또는 `user` 또는 `deleted`(논리 삭제)
  * `type`: 분류 타입 - `app`, `web`, `card`
  * `order`: 배치순서

* `Basic`에 해당하는 기본 자료 등록

  ```sql
  INSERT INTO `meedawn`.`snapshot`
  (`id`, `filename`, `path`, `host`, `type`, `order`, `member_userid`)
  VALUES
  (1, 'portfolio-1', 'resources/img/portfolio/portfolio-1.jpg', 'admin', 'app', 1, 'admin');
  ```

* 기본 자료 예시

  <img src="파일업로드.assets/image-20220620161908775.png" alt="image-20220620161908775" style="zoom:50%;" />

​                 

#### - maven

* 의존관계를 추가한다.(pom.xml)

  ```xml
  <!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload -->
  <dependency>
      <groupId>commons-fileupload</groupId>
      <artifactId>commons-fileupload</artifactId>
      <version>1.3.3</version>
  </dependency>
  ```

* 세팅을 추가한다.(servlet-context.xml)

  ```xml
  <beans:bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
  	<beans:property name="defaultEncoding" value="UTF-8"/>
    <beans:property name="maxUploadSize" value="52428800"/> <!--50MB-->
    <beans:property name="maxInMemorySize" value="1048576"/> <!--1MB-->
  </beans:bean>
  ```

  

​                 

## 파일 업로드(File Upload With JSON)

> SPA 환경에서 JSON을 이용해 파일을 전송한다.

​              

### 1. 버튼 만들기

<img src="파일업로드.assets/image-20220620140509449.png" alt="image-20220620140509449" style="zoom: 25%;" />

```html
<div class="text-right">
					<button type="button" class="btn btn-success" id="my-capture-btn">My Capture</button>
					<button type="button" class="btn btn-secondary" id="basic-capture-btn">Basic</button>
				</div>
```

​                 

* My Capture 버튼을 누르면 **Edit** 버튼 활성화 & Basic 버튼을 누르면 초기 버튼 설정

  <img src="파일업로드.assets/image-20220620142736821.png" alt="image-20220620142736821" style="zoom: 25%;" />

  ```js
  /******************
      		Snapshot
   ******************/
      	 
  $('#my-capture-btn').on("click", function(){
     $('#my-capture-edit-btn').show();
     $('#my-capture-btn').hide();
  });
      	
      	
  $('#basic-capture-btn').on("click", function(){
     $('#my-capture-edit-btn').hide();
     $('#my-capture-btn').show();
  });
  ```

​                

* file 업로드를 위한 `input` 태그추가

  ```html
  <form class="modal" id="myModal4" enctype="multipart/form-data">
    
  <input type="file" class="form-control" name="upfile" multiple="multiple">
    
  </form>
  ```

  <img src="파일업로드.assets/image-20220621162401638.png" alt="image-20220621162401638" style="zoom:25%;" />

  * Add 버튼을 누르면 사진을 등록할 수 있다.

​            

### 2. DTO 생성

```java
package com.meedawn.flower.model;

public class SnapshotDto {
	private String filename;
	private String path;
	private String host;
	private String type;
	private int order;
	private String member_userid;
	public String getFilename() {
		return filename;
	}
	public void setFilename(String filename) {
		this.filename = filename;
	}
	public String getPath() {
		return path;
	}
	public void setPath(String path) {
		this.path = path;
	}
	public String getHost() {
		return host;
	}
	public void setHost(String host) {
		this.host = host;
	}
	public String getType() {
		return type;
	}
	public void setType(String type) {
		this.type = type;
	}
	public int getOrder() {
		return order;
	}
	public void setOrder(int order) {
		this.order = order;
	}
	public String getMember_userid() {
		return member_userid;
	}
	public void setMember_userid(String member_userid) {
		this.member_userid = member_userid;
	}
	@Override
	public String toString() {
		return "SnapshotDto [filename=" + filename + ", path=" + path + ", host=" + host + ", type=" + type + ", order="
				+ order + ", member_userid=" + member_userid + "]";
	}
	
}
```

​             

### 3. json 형식으로 file 전송하기

* 원칙적으로 file은 JSON에 포함될 수 없다.
* JSON과 file 묶어서 보내준다.

```
```



### 4. MyBatis 사용을 위한 snapshot.xml 생성



### 5. Controller 생성

