# ë°±ì—”ë“œ

### ë°°í¬ìš© application.properties ì‘ì„±

<aside>
ğŸ’¡ SSL ì ìš©ì„ ìœ„í•œ `key` ë¥¼ ì €ì¥ì†Œì— ë…¸ì¶œì‹œí‚¤ì§€ ì•Šê¸° ìœ„í•´ Docker Volumeì„ í™œìš©í•´ `SSL` ì„ ì ìš©í•©ë‹ˆë‹¤.
ê·¸ë˜ì„œ ì´ ë°©ë²•ì€ ê°œë°œ ì„œë²„ëŠ” HTTP, ë°°í¬ ì„œë²„ëŠ” HTTPSë¡œ ì‘ë™í•©ë‹ˆë‹¤.

</aside>

<aside>
ğŸ’¡ `ê°œë°œìš©` properties ì™€ `ë°°í¬ìš©` properties ë¥¼ ë¶„ë¦¬í•´ì„œ ì‘ì„±í•©ë‹ˆë‹¤.
ê° properties ì— í•„ìš”í•œ ì„¤ì •(DB, SSL ë“±ë“±)ì„ êµ¬ë¶„í•´ì„œ ì‘ì„±í•´ì£¼ì„¸ìš”.

</aside>

1. ë°°í¬ìš© ì„¤ì •ì„ ì…ë ¥í•˜ê¸° ìœ„í•œ `application-prod.properties` ìƒì„±
2. ê¸°ì¡´ ì„¤ì • + SSL ì„¤ì • ì‘ì„±

![Untitled](%E1%84%87%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%207b021a55c9f5463997e6cb960398f377/Untitled.png)

```
# application-prod.properties
# SSL ì„¤ì •

server.port=8443
server.ssl.enabled=true
server.ssl.key-store-type=PKCS12
server.ssl.key-store=/root/key.p12
server.ssl.key-store-password=#ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸
```

### Dockerfile ì‘ì„±

<aside>
ğŸ’¡ Gradle ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ëœ ê°€ì´ë“œì…ë‹ˆë‹¤. Maven ì‚¬ìš©ìëŠ” í”„ë¡œì íŠ¸ì— ë§ê²Œ ê²½ë¡œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.

</aside>

```docker
# backend/Dockerfile
# ì‚¬ìš©í•œ java ë²„ì „ì— ë§ëŠ” ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
FROM openjdk:8-jdk-alpine

# jar íŒŒì¼ ê²½ë¡œëŠ” ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.
COPY build/libs/backend-0.0.1-SNAPSHOT.jar app.jar

# ë°°í¬ìš© properties ì‹¤í–‰ ëª…ë ¹ì–´
ENTRYPOINT ["java","-jar","app.jar","--spring.config.name=application-prod"] 

# ë§Œì•½ ë°°í¬ìš© propertiesë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´
# Default properties ì‹¤í–‰ ëª…ë ¹ì–´
# ENTRYPOINT ["java","-jar","app.jar"]
```

### React ì ìš©

```docker
# backend/Dockerfile
# ì‚¬ìš©í•œ java ë²„ì „ì— ë§ëŠ” ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
FROM openjdk:11

# jar íŒŒì¼ ê²½ë¡œëŠ” ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.
COPY build/libs/backend-0.0.1-SNAPSHOT.jar app.jar

# ë°°í¬ìš© properties ì‹¤í–‰ ëª…ë ¹ì–´
ENTRYPOINT ["java","-jar","app.jar","--spring.config.name=application-prod"]

# ë§Œì•½ ë°°í¬ìš© propertiesë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´
# Default properties ì‹¤í–‰ ëª…ë ¹ì–´
# ENTRYPOINT ["java","-jar","app.jar"]
```

### ì˜¤ë¥˜

ì  í‚¨ìŠ¤ ë¹Œë“œ í›„ ë°”ë¡œ ì£½ëŠ” ë¬¸ì œ

1. ë©”ì¸ ì„¤ì • íŒŒì¼ì—ì„œ prod íŒŒì¼ì„ ì—®ì–´ì„œ ìƒê¸°ëŠ” ë¬¸ì œ

```docker
spring.profiles.include=oauth,prod # prodë¥¼ ì¨ì„œ ì˜¤ë¥˜
spring.profiles.include=oauth # ì´ë ‡ê²Œ ì—°ê²°ì„ í•´ì œí•œ í›„
```

1. dockerfileì—ì„œ `â€”spring.config.name=` ì—ì„œ í”„ë¡œí¼í‹°ì˜ ì´ë¦„ì„ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´ ê·¸ ì„¤ì •ë§Œ ì ìš©ëœë‹¤. ê·¸ëŸ¬ë¯€ë¡œ í”„ë¡œí¼í‹°ë¥¼ ì—¬ëŸ¬ ê°œ ì§€ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.

```docker
# backend/Dockerfile
# ì‚¬ìš©í•œ java ë²„ì „ì— ë§ëŠ” ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
FROM openjdk:8-jdk-alpine

# jar íŒŒì¼ ê²½ë¡œëŠ” ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.
COPY build/libs/backend-0.0.1-SNAPSHOT.jar app.jar

# ë°°í¬ìš© properties ì‹¤í–‰ ëª…ë ¹ì–´
ENTRYPOINT ["java","-jar","app.jar","--spring.config.name=application,application-prod"]
# ì ìš©í•  ëª¨ë“  í”„ë¡œí¼í‹° ì´ë¦„ì„ ì ì–´ì¤€ë‹¤.
```