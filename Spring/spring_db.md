# 스프링 DB 접근 기술

> 서버에서 받은 정보를 데이터베이스로 연결해 저장해주어야한다.

​              

## H2 데이터베이스 설치

* 개발이나 테스트 용도로 가볍고 편리한 DB, 웹 화면 제공(교육용으로 좋음)

* H2 데이터베이스는 스프링부트 버전과 맞춘다.

* H2 메인 페이지에서 다운 받은 후(8MB) bin 폴더에서 `h2.sh` 파일을 찾는다.

  * MAC의 경우 실행 권한을 부여해준다.

  ```bash
  chmod 755 h2.sh
  ```

  * 실행법

  ```bash
  ./h2.sh
  # 윈도우 사용자는 h2.bat
  ```

  <img src="spring_db.assets/image-20220227220344434.png" alt="image-20220227220344434" style="zoom:67%;" />

  * 연결 클릭 : 데이터베이스 생성

    <img src="spring_db.assets/image-20220227220537744.png" alt="image-20220227220537744" style="zoom:67%;" />

  * ```bash
    $ cd ~
    ## home 으로 간 다음 파일 목록 검색
    $ ll
    ## test.mv.db 파일이 있는지 확인
    ```

    <img src="spring_db.assets/image-20220227220733504.png" alt="image-20220227220733504" style="zoom:50%;" />

  * 파일을 확인했다면 더 이상 파일 접근이 아니라 `localhost`로 접근해주어야 한다.

  ```bash
  jdbc:h2:tcp://localhost/~/test
  ```

  <img src="spring_db.assets/image-20220227221001746.png" alt="image-20220227221001746" style="zoom:50%;" />

  * **서버(톰캣)로 접근해야 여러 곳에서 접근 가능**하며 파일로 접근하면 오류가 발생할 수 있다.

​            

## 테이블 만들기

* CREATE TABLE

```mysql
create table member
(
  id   bigint generated by default as identity, /*값을 설정하지 않으면 자동으로 값을 넣어줌*/
  name varchar(255),
  primary key (id)
);
```

* 조회

```mysql
select * from member;
```

* 테이블에 값 넣기

```java
 insert into member(name) values('spring')
```

<img src="spring_db.assets/image-20220227221845467.png" alt="image-20220227221845467" style="zoom:50%;" />

​           

### spring 내부 폴더 생성

* 프로젝트 메인 폴더 내부에 `sql` 디렉토리 생성
* `sql` 내부에 `ddl.sql` 파일 생성

<img src="spring_db.assets/image-20220227223427498.png" alt="image-20220227223427498" style="zoom:50%;" />

* 코드 입력

```mysql
 drop table if exists member CASCADE;
    create table member
    (
        id   bigint generated by default as identity,
        name varchar(255),
        primary key (id)
);
```

